(this.webpackJsonpsea_battle=this.webpackJsonpsea_battle||[]).push([[0],[,,,,,,,function(e,t,n){e.exports=n(20)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),l=n.n(a),o=n(4),i=(n(12),n(13),function(){return l.a.createElement("div",{id:"App"},l.a.createElement(I,null))}),c=(n(14),{fieldSize:10,ships:{battleship:{size:4,amount:1,units:[],destroyed:[]},cruiser:{size:3,amount:2,units:[],destroyed:[]},destroyer:{size:2,amount:3,units:[],destroyed:[]},boat:{size:1,amount:4,units:[],destroyed:[]}},safeValue:5,timeAIIsWaiting:500,timerStart:30}),u=function(e){var t=e.field,n=e.mode,r=e.playFor,a=e.handleClick;return l.a.createElement("div",{id:"field"},t.map((function(e,t){return l.a.createElement("div",{id:"row",key:t},e.map((function(e,o){var i=function(e){var t="cell",a="empty";return parseInt(e)===-1*c.safeValue?a="missed":parseInt(e)<0&&(a="killed"),"prepare"===n&&(t+=" big_cell"),"string"===typeof e?t+=" safe":"play"===n&&"AI"===r||"prepare"===n&&"player"===r?e&&Math.abs(e)!==c.safeValue||(t+=" empty"):"killed"!==a&&(t+=" empty"),{idName:a,className:t}}(e),u=i.idName,s=i.className;return l.a.createElement("div",{className:s,onClick:function(){return a(t,o,r)},key:o},l.a.createElement("div",{id:u},"killed"===u&&l.a.createElement("img",{src:"./img/fire.png",alt:"killed"})))})))})))},s=n(6),f=n(2),d=n.n(f),m=(n(17),function(e,t,n){var r=[e],a=[{futureShip:e.y-n,offset:{y:-1,x:0}},{futureShip:e.x+n,offset:{y:0,x:1}},{futureShip:e.y+n,offset:{y:1,x:0}},{futureShip:e.x-n,offset:{y:0,x:-1}}],l=function(a){var l=a.futureShip,o=a.offset;if(0<=l&&l<c.fieldSize){for(var i=[],u=n;u;)i.push(t[e.y+u*o.y][e.x+u*o.x]),u--;i.every((function(e){return!e}))&&i.forEach((function(t,n){return r.push(new O(e.y+(n+1)*o.y,e.x+(n+1)*o.x))}))}};if(n)do{var o=d.a.random(a.length-1);l(a[o]),1===r.length&&a.splice(o,1)}while(1===r.length&&a.length);return r}),p=function(e,t){var n=E(e),r=[];do{var a=n[d.a.random(n.length-1)];r=m(a,e,t-1)}while(r.length!==t);return r.forEach((function(n){return e[n.y][n.x]=t})),h(e,r),{coords:r,renderedField:e}},h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=c.safeValue,a=c.fieldSize,l=[-1,0,1];t.forEach((function(t){l.forEach((function(o){var i=t.y+o;l.forEach((function(l){var o=t.x+l;0<=i&&i<a&&0<=o&&o<a&&(n&&Math.abs(e[i][o])===c.safeValue||!e[i][o])&&(e[i][o]=n?String(e[i][o]):r)}))}))}))},b=function(e,t,n){var r=n.ship||{startPoint:null,endPoint:null},a=r.startPoint,l=r.endPoint,o={row:null,cell:null},i={startPoint:null,endPoint:null},u=function(e,t){return 0<=e&&e<c.fieldSize&&0<=t&&t<c.fieldSize},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=l.row-a.row,r=l.cell-a.cell,o=t?-1:1;return console.log("moving",n,r),{row:n?e.row+o*(n/Math.abs(n)):e.row,cell:r?e.cell+o*(r/Math.abs(r)):e.cell}},f=function(){var t={tailRow:null,tailCell:null},n=[{offset:{row:-1,cell:0}},{offset:{row:0,cell:1}},{offset:{row:1,cell:0}},{offset:{row:0,cell:-1}}].filter((function(t){return u(a.row+t.offset.row,a.cell+t.offset.cell)&&!e[a.row+t.offset.row][a.cell+t.offset.cell]}));if(a.row-l.row&&a.cell-l.cell){var r=s(a),o=n.findIndex((function(e){return e.offset.row===r.row-a.row&&e.offset.cell===r.cell-a.cell}));-1!==o&&(t.tailRow=a.row+n[o].offset.row,t.tailCell=a.cell+n[o].offset.cell)}if(null===t.tailCell){var i=n[d.a.random(n.length-1)].offset;t.tailRow=a.row+i.row,t.tailCell=a.cell+i.cell,console.log("tryDir",i)}return console.log("tail",t),t};if(!a||e[a.row][a.cell]===-1*c.safeValue||t){console.log("in first",a,l,t),a&&console.log("first",e[a.row][a.cell]);var m=function(){var t={},n=0,r=E(e);do{t=r[d.a.random(r.length-1)],n=+e[t.y][t.x]}while(n<0||5===n||"0"===e[t.y][t.x]);return{headRow:t.y,headCell:t.x}}(),p=m.headRow,h=m.headCell;o.row=p,o.cell=h,i.startPoint=g(o),i.endPoint=g(o),console.log("out first",o)}else if(!l||a.row===l.row&&a.cell===l.cell||e[l.row][l.cell]===-1*c.safeValue){console.log("in second",a,l);var b=f(),v=b.tailRow,y=b.tailCell;o.row=v,o.cell=y,i.startPoint=a,i.endPoint=g(o),console.log("out second",i,o)}else{console.log("in third",a,l);var w=s(l),O=w.row,j=w.cell;if(console.log("continue",O,j),!u(O,j)||Math.abs(+e[O][j])===c.safeValue){var S=f();O=S.tailRow,j=S.tailCell}o.row=O,o.cell=j,i.startPoint=a,i.endPoint=g(o),console.log("out third",i,o)}return{rowAI:o.row,cellAI:o.cell,ship:i}},v=new Array(c.fieldSize).fill(new Array(c.fieldSize).fill(0)),y=n(5),g=function(e){var t={};return e instanceof Array?t=e.map((function(e){return Object(y.a)(e)})):e instanceof Object&&(t=JSON.parse(JSON.stringify(e))),t},w=function(e,t,n){var r=-1*(+e[t][n]?+e[t][n]:c.safeValue);return e[t][n]="string"===typeof e[t][n]?String(r):r,e[t][n]},E=function(e){return e.flat().map((function(e,t){if(!e)return new O(Math.floor(t/c.fieldSize),t%c.fieldSize)})).filter((function(e){return e instanceof O}))};var O=function(e,t){this.x=t,this.y=e},j=function(e){return Object.fromEntries(Object.entries(g(c.ships)).map((function(t){var n=Object(r.a)(t,2),a=n[0],l=n[1];return d.a.times(l.amount,(function(){var t=p(e,l.size),n=t.coords,r=t.renderedField;l.units.push(n),e=r})),l.destroyed=new Array(l.amount).fill(0),[a,l]})))},S=function(e,t,n){var a=null;return Object.entries(e).forEach((function(e){var l=Object(r.a)(e,2),o=(l[0],l[1]),i=o.units.findIndex((function(e){return!!e.filter((function(e){return e.y===t&&e.x===n})).length}));-1!==i&&++o.destroyed[i]===o.size&&(a=o.units[i])})),a},I=function(){var e=Object(a.useState)("prepare"),t=Object(r.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(g(v)),f=Object(r.a)(i,2),d=f[0],m=f[1],p=Object(a.useState)(g(v)),y=Object(r.a)(p,2),E=y[0],O=y[1],I=Object(a.useState)(g(c.ships)),k=Object(r.a)(I,2),A=k[0],C=k[1],N=Object(a.useState)(g(v)),z=Object(r.a)(N,2),P=z[0],V=z[1],M=Object(a.useState)(g(c.ships)),T=Object(r.a)(M,2),F=T[0],R=T[1],J=Object(a.useState)({}),_=Object(r.a)(J,2),B=_[0],D=_[1],W=Object(a.useState)(!1),q=Object(r.a)(W,2),G=q[0],H=q[1],K=Object(a.useState)({status:!1,person:""}),L=Object(r.a)(K,2),Q=L[0],U=L[1],X=Object(a.useState)(!0),Y=Object(r.a)(X,2),Z=Y[0],$=Y[1],ee=Object(a.useState)(0),te=Object(r.a)(ee,2),ne=(te[0],te[1]);function re(e,t,r){if("play"===n&&"player"===r&&E[e][t]>=0&&!G&&Z){var a=g(E);if(w(a,e,t),+a[e][t]!==-1*c.safeValue){var l=S(A,e,t);l&&(h(a,l,!0),ae("person",a)),O(a)}else{O(a);var o=g(P),i=g(d),u=B,f=0,p=!1,v=!1,y=function(){m(i),V(o),D(u)},j=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(t,n){+f===-1*c.safeValue||v?n("finished"):(e&&y(),H(!0),setTimeout((function(){H(!1),t(b(g(i),p,u))}),c.timeAIIsWaiting))}))};!function e(t){t.then((function(t){var n=t.rowAI,r=t.cellAI,a=Object(s.a)(t,["rowAI","cellAI"]);p=!1,u=a,i[n][r]=f=w(o,n,r);var l=S(F,n,r);l&&(p=!0,h(o,l,!0),h(i,l,!0),v=ae("AI",o)),e(j(!0))}),(function(e){y()}))}(j())}}}Object(a.useEffect)((function(){if("prepare"===n){var e=g(v),t=g(v);C(j(e)),O(e),R(j(t)),V(t),m(g(v)),D({})}}),[n]),Object(a.useEffect)((function(){Q.status&&("person"===Q.person?alert("\u041f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u044f\u0435\u043c! \u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!"):alert("\u042d\u0442\u043e \u043f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435...\u0423\u0432\u044b :("),o("prepare"),$(!1),U({status:!1,person:""}))}),[Q]);var ae=function(e,t){if(function(e){return!e.filter((function(e){return!!e.filter((function(e){return+e>0&&+e!==c.safeValue})).length})).length}(t)){var n="person";return"AI"===e&&(n="AI"),U({status:!0,person:n}),!0}return!1};return l.a.createElement("div",{id:"game"},"play"===n&&l.a.createElement(x,{action:Z,changeStopTime:function(e){return ne(e)}}),l.a.createElement("div",{id:"fields"},l.a.createElement(u,{playFor:"prepare"===n?"player":"AI",field:P,mode:n,handleClick:re}),"play"===n&&l.a.createElement(u,{playFor:"player",field:E,mode:n,handleClick:re})),l.a.createElement("div",{className:"button_group"},l.a.createElement("img",{src:"./img/".concat("prepare"===n?"power-button":"refresh",".png"),alt:"control",onClick:function(){"prepare"===n?(o("play"),$(!0)):($(!1),o("prepare"))}}),"play"===n&&l.a.createElement("img",{src:"./img/".concat(Z?"pause":"play",".png"),alt:"timer",onClick:function(){return $((function(e){return!e}))}})))},x=(n(18),function(e){var t=e.action,n=e.changeStopTime,o=Object(a.useState)(0),i=Object(r.a)(o,2),c=i[0],u=i[1],s=Object(a.useState)(null),f=Object(r.a)(s,2),d=f[0],m=f[1],p=Object(a.useState)(null),h=Object(r.a)(p,2),b=h[0],v=h[1],y=Object(a.useState)(null),g=Object(r.a)(y,2),w=g[0],E=g[1],O=Object(a.useState)(null),j=Object(r.a)(O,2),S=j[0],I=j[1];return Object(a.useEffect)((function(){return t?m(setInterval((function(){u((function(e){return e+1}))}),1e3)):clearInterval(d)}),[t]),Object(a.useEffect)((function(){return n(c)})),Object(a.useEffect)((function(){var e,t,n;e=Math.floor(c/3600),t=Math.floor((c-3600*e)/60),n=c-(3600*e+60*t),v(String(e).padStart(2,"0")),E(String(t).padStart(2,"0")),I(String(n).padStart(2,"0"))}),[c]),l.a.createElement("div",{id:"timer"},b," : ",w," : ",S)}),k=(n(19),document.getElementById("id01"));window.onclick=function(e){e.target===k&&(k.style.display="none")};var A=function(e){var t=e.logIn,n=Object(a.useState)(""),o=Object(r.a)(n,2),i=o[0],c=o[1];return l.a.createElement("div",null,l.a.createElement("button",{onClick:function(){return document.getElementById("id01").style.display="block"},className:"ENT"},"\u0418\u0433\u0440\u0430\u0442\u044c \xab\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0411\u043e\u0439\xbb"),l.a.createElement("div",{id:"id01",className:"modal"},l.a.createElement("form",{className:"modal-content animate",onSubmit:function(e){e.preventDefault(),fetch("/api/users",{method:"post",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({name:i})}).then((function(e){throw 200===e.status&&(console.log("entered!",e),t(i)),new Error(e.statusText)})).catch((function(e){return alert("\u041e\u0448\u0438\u0431\u043a\u0430 POST, ".concat(e))})),fetch("/api/users").then((function(e){throw 200===e.status&&console.log("success",e),new Error(e.statusText)})).catch((function(e){return alert("\u041e\u0448\u0438\u0431\u043a\u0430 GET, ".concat(e))}))}},l.a.createElement("div",{className:"imgcontainer"},l.a.createElement("span",{onClick:function(){return document.getElementById("id01").style.display="none"},className:"close",title:"Close Modal"},"\xd7"),l.a.createElement("img",{src:"https://thumbs.gfycat.com/FrankFreeAmericankestrel-size_restricted.gif",alt:"Avatar",className:"avatar"})),l.a.createElement("div",{className:"container"},l.a.createElement("label",{htmlFor:"uname",style:{fontSize:"2vh"}},l.a.createElement("b",null,"\u041f\u0440\u0438\u0432\u0435\u0442, \u044f Smart, \u0430 \u0442\u044b...")),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("input",{className:"form-row",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f",name:"uname",autoComplete:"off",value:i,onChange:function(e){return c(e.target.value)},required:!0}),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("button",{type:"submit",className:"button1"},"\u0418\u0413\u0420\u0410\u0422\u042c")))))};Object(o.render)(l.a.createElement((function(){var e=Object(a.useState)(""),t=Object(r.a)(e,2),n=t[0],o=t[1];return n?l.a.createElement(i,{userName:n}):l.a.createElement(A,{logIn:function(e){o(e)}})}),null),document.getElementById("root"))}],[[7,1,2]]]);
//# sourceMappingURL=main.5e70daf4.chunk.js.map