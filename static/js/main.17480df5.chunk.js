(this.webpackJsonpsea_battle=this.webpackJsonpsea_battle||[]).push([[0],[,,,,,,,,,,,,,function(e,t,a){e.exports=a(28)},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(1),l=a(0),c=a.n(l),s=a(10),o=(a(18),a(19),function(e){var t=e.logout,a=e.userName;return c.a.createElement("div",{id:"App"},c.a.createElement("img",{className:"logout",src:"./img/logout.png",alt:"logout",onClick:function(){return t()}}),c.a.createElement(x,{name:a}),c.a.createElement(V,null))}),i=(a(20),{fieldSize:10,ships:{battleship:{size:4,amount:1,units:[],destroyed:[]},cruiser:{size:3,amount:2,units:[],destroyed:[]},destroyer:{size:2,amount:3,units:[],destroyed:[]},boat:{size:1,amount:4,units:[],destroyed:[]}},safeValue:5,timeAIIsWaiting:500,timerStart:30,defaultHeaders:{"Content-Type":"application/json; charset=utf-8"}}),u=function(e){var t=e.field,a=e.mode,n=e.playFor,r=e.handleClick;return c.a.createElement("div",{className:"field"},t.map((function(e,t){return c.a.createElement("div",{className:"row",key:t},e.map((function(e,l){var s=function(e){var t="cell",r="empty";return parseInt(e)===-1*i.safeValue?r="missed":parseInt(e)<0&&(r="killed"),"prepare"===a&&(t+=" big_cell"),"string"===typeof e?t+=" safe":"play"===a&&"AI"===n||"prepare"===a&&"player"===n?e&&Math.abs(e)!==i.safeValue||(t+=" empty"):"killed"!==r&&(t+=" empty"),{idName:r,className:t}}(e),o=s.idName,u=s.className;return c.a.createElement("div",{className:u,onClick:function(){return r(t,l,n)},key:l},c.a.createElement("div",{id:o},"killed"===o&&c.a.createElement("img",{src:"./img/fire.png",alt:"killed"})))})))})))},f=a(12),m=a(2),d=a.n(m),p=(a(23),function(e,t,a){var n=[e],r=[{futureShip:e.y-a,offset:{y:-1,x:0}},{futureShip:e.x+a,offset:{y:0,x:1}},{futureShip:e.y+a,offset:{y:1,x:0}},{futureShip:e.x-a,offset:{y:0,x:-1}}],l=function(r){var l=r.futureShip,c=r.offset;if(0<=l&&l<i.fieldSize){for(var s=[],o=a;o;)s.push(t[e.y+o*c.y][e.x+o*c.x]),o--;s.every((function(e){return!e}))&&s.forEach((function(t,a){return n.push(new w(e.y+(a+1)*c.y,e.x+(a+1)*c.x))}))}};if(a)do{var c=d.a.random(r.length-1);l(r[c]),1===n.length&&r.splice(c,1)}while(1===n.length&&r.length);return n}),h=function(e,t){var a=O(e),n=[];do{var r=a[d.a.random(a.length-1)];n=p(r,e,t-1)}while(n.length!==t);return n.forEach((function(a){return e[a.y][a.x]=t})),b(e,n),{coords:n,renderedField:e}},b=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=i.safeValue,r=i.fieldSize,l=[-1,0,1];t.forEach((function(t){l.forEach((function(c){var s=t.y+c;l.forEach((function(l){var c=t.x+l;0<=s&&s<r&&0<=c&&c<r&&(a&&Math.abs(e[s][c])===i.safeValue||!e[s][c])&&(e[s][c]=a?String(e[s][c]):n)}))}))}))},v=function(e,t,a){var n=a.ship||{startPoint:null,endPoint:null},r=n.startPoint,l=n.endPoint,c={row:null,cell:null},s={startPoint:null,endPoint:null},o=function(e,t){return 0<=e&&e<i.fieldSize&&0<=t&&t<i.fieldSize},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=l.row-r.row,n=l.cell-r.cell,c=t?-1:1;return{row:a?e.row+c*(a/Math.abs(a)):e.row,cell:n?e.cell+c*(n/Math.abs(n)):e.cell}},f=function(){var t={tailRow:null,tailCell:null},a=[{offset:{row:-1,cell:0}},{offset:{row:0,cell:1}},{offset:{row:1,cell:0}},{offset:{row:0,cell:-1}}].filter((function(t){return o(r.row+t.offset.row,r.cell+t.offset.cell)&&!e[r.row+t.offset.row][r.cell+t.offset.cell]}));if(r.row-l.row&&r.cell-l.cell){var n=u(r),c=a.findIndex((function(e){return e.offset.row===n.row-r.row&&e.offset.cell===n.cell-r.cell}));-1!==c&&(t.tailRow=r.row+a[c].offset.row,t.tailCell=r.cell+a[c].offset.cell)}if(null===t.tailCell){var s=a[d.a.random(a.length-1)].offset;t.tailRow=r.row+s.row,t.tailCell=r.cell+s.cell}return t};if(!r||e[r.row][r.cell]===-1*i.safeValue||t){var m=function(){var t={},a=0,n=O(e);do{t=n[d.a.random(n.length-1)],a=+e[t.y][t.x]}while(a<0||5===a||"0"===e[t.y][t.x]);return{headRow:t.y,headCell:t.x}}(),p=m.headRow,h=m.headCell;c.row=p,c.cell=h,s.startPoint=E(c),s.endPoint=E(c)}else if(!l||r.row===l.row&&r.cell===l.cell||e[l.row][l.cell]===-1*i.safeValue){var b=f(),v=b.tailRow,y=b.tailCell;c.row=v,c.cell=y,s.startPoint=r,s.endPoint=E(c)}else{var g=u(l),j=g.row,w=g.cell;if(!o(j,w)||Math.abs(+e[j][w])===i.safeValue){var S=f();j=S.tailRow,w=S.tailCell}c.row=j,c.cell=w,s.startPoint=r,s.endPoint=E(c)}return{rowAI:c.row,cellAI:c.cell,ship:s}},y=new Array(i.fieldSize).fill(new Array(i.fieldSize).fill(0)),g=a(11),E=function(e){var t={};return e instanceof Array?t=e.map((function(e){return Object(g.a)(e)})):e instanceof Object&&(t=JSON.parse(JSON.stringify(e))),t},j=function(e,t,a){var n=-1*(+e[t][a]?+e[t][a]:i.safeValue);return e[t][a]="string"===typeof e[t][a]?String(n):n,e[t][a]},O=function(e){return e.flat().map((function(e,t){if(!e)return new w(Math.floor(t/i.fieldSize),t%i.fieldSize)})).filter((function(e){return e instanceof w}))};var w=function(e,t){this.x=t,this.y=e},S=function(e){return Object.fromEntries(Object.entries(E(i.ships)).map((function(t){var a=Object(r.a)(t,2),n=a[0],l=a[1];return d.a.times(l.amount,(function(){var t=h(e,l.size),a=t.coords,n=t.renderedField;l.units.push(a),e=n})),l.destroyed=new Array(l.amount).fill(0),[n,l]})))},N=function(e,t,a){var n=null,l=null,c=null;return Object.entries(e).forEach((function(e){var s=Object(r.a)(e,2),o=s[0],i=s[1],u=i.units.findIndex((function(e){return!!e.filter((function(e){return e.y===t&&e.x===a})).length}));-1!==u&&++i.destroyed[u]===i.size&&(n=i.units[u],l=o,c=u)})),{destroyedShip:n,shipType:l,destroyedIndex:c}},x=function(e){var t=e.name,a=Object(l.useState)(""),s=Object(r.a)(a,2),o=s[0],m=s[1],d=Object(l.useState)("prepare"),p=Object(r.a)(d,2),h=p[0],g=p[1],O=Object(l.useState)("false"),w=Object(r.a)(O,2),x=w[0],C=w[1],k=Object(l.useState)(E(y)),A=Object(r.a)(k,2),M=A[0],z=A[1],_=Object(l.useState)(E(y)),P=Object(r.a)(_,2),V=P[0],T=P[1],F=Object(l.useState)(E(i.ships)),J=Object(r.a)(F,2),B=J[0],H=J[1],D=Object(l.useState)(E(y)),W=Object(r.a)(D,2),q=W[0],G=W[1],K=Object(l.useState)(E(i.ships)),L=Object(r.a)(K,2),Q=L[0],U=L[1],X=Object(l.useState)({}),Y=Object(r.a)(X,2),Z=Y[0],$=Y[1],ee=Object(l.useState)(!1),te=Object(r.a)(ee,2),ae=te[0],ne=te[1],re=Object(l.useState)({status:!1,person:""}),le=Object(r.a)(re,2),ce=le[0],se=le[1],oe=Object(l.useState)(!0),ie=Object(r.a)(oe,2),ue=ie[0],fe=ie[1];Object(l.useEffect)((function(){if("prepare"===h||x){var e=E(y),t=E(y);H(S(e)),T(e),U(S(t)),G(t),z(E(y)),$({}),C(!1)}}),[h,x]),Object(l.useEffect)((function(){ce.status&&("person"===ce.person?alert("\u041f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u044f\u0435\u043c! \u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!"):alert("\u042d\u0442\u043e \u043f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435...\u0423\u0432\u044b :("),g("prepare"),fe(!1),se({status:!1,person:""}),me())}));var me=function(){o?fetch("/api/records",{method:"patch",headers:Object(n.a)({},i.defaultHeaders),body:JSON.stringify({id:o,score:V.flat().filter((function(e){return+e>0&&+e!==i.safeValue})).length})}).then((function(e){if(200!==e.status)throw new Error(e.statusText);console.log("Sent score data successfully")})).catch((function(e){return console.log(e)})):console.log("Game ID \u043d\u0435 \u0437\u0430\u0434\u0430\u043d")};function de(e,t,a){if("play"===h&&"player"===a&&V[e][t]>=0&&!ae&&ue){var n=E(V);if(j(n,e,t),+n[e][t]!==-1*i.safeValue){var r=N(B,e,t),l=r.destroyedShip,c=r.shipType,s=r.destroyedIndex;if(l){var o=E(B);o[c].units.splice(s,1),H(o),b(n,l,!0),pe("person",n)}T(n)}else{T(n);var u=E(q),m=E(M),d=Z,p=0,y=!1,g=!1,O=function(){z(m),G(u),$(d)},w=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(t,a){+p===-1*i.safeValue||g?a("finished"):(e&&O(),ne(!0),setTimeout((function(){ne(!1),t(v(E(m),y,d))}),i.timeAIIsWaiting))}))};!function e(t){t.then((function(t){var a=t.rowAI,n=t.cellAI,r=Object(f.a)(t,["rowAI","cellAI"]);y=!1,d=r,m[a][n]=p=j(u,a,n);var l=N(Q,a,n),c=l.destroyedShip,s=l.shipType,o=l.destroyedIndex;if(c){y=!0;var i=E(Q);i[s].units.splice(o,1),U(i),b(u,c,!0),b(m,c,!0),g=pe("AI",u)}e(w(!0))}),(function(e){O()}))}(w())}}}var pe=function(e,t){if(function(e){return!e.filter((function(e){return!!e.filter((function(e){return+e>0&&+e!==i.safeValue})).length})).length}(t)){var a="person";return"AI"===e&&(a="AI"),se({status:!0,person:a}),!0}return!1};return c.a.createElement("div",{id:"game"},"play"===h&&c.a.createElement("div",{className:"game_header"},c.a.createElement(R,{fleet:Q,name:"Smart",player:"AI"}),c.a.createElement(I,{action:ue}),c.a.createElement(R,{fleet:B,name:t,player:"user"})),c.a.createElement("div",{id:"fields"},c.a.createElement(u,{playFor:"prepare"===h?"player":"AI",field:q,mode:h,handleClick:de}),"play"===h&&c.a.createElement(u,{playFor:"player",field:V,mode:h,handleClick:de})),c.a.createElement("div",{className:"button_group"},c.a.createElement("img",{src:"./img/".concat("prepare"===h?"power-button":"refresh",".png"),alt:"control",onClick:function(){"prepare"===h?(g("play"),fe(!0),fetch("/api/records",{method:"post",headers:Object(n.a)({},i.defaultHeaders),body:JSON.stringify({game:"\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0431\u043e\u0439"})}).then((function(e){if(200===e.status)return console.log("Successfully notify server about game start"),e.json();throw new Error(e.statusText)})).then((function(e){console.log(e),m(e.id)})).catch((function(e){return console.log(e)}))):(fe(!1),g("prepare"),me())}}),"prepare"===h?c.a.createElement("img",{src:"./img/loop.png",alt:"refresh",onClick:function(){return C(!0)}}):c.a.createElement("img",{src:"./img/".concat(ue?"pause":"play",".png"),alt:"timer",onClick:function(){ue&&me(),fe((function(e){return!e}))}})))},I=(a(24),function(e){var t=e.action,a=Object(l.useState)(0),n=Object(r.a)(a,2),s=n[0],o=n[1],i=Object(l.useState)(null),u=Object(r.a)(i,2),f=u[0],m=u[1],d=Object(l.useState)(null),p=Object(r.a)(d,2),h=p[0],b=p[1],v=Object(l.useState)(null),y=Object(r.a)(v,2),g=y[0],E=y[1],j=Object(l.useState)(null),O=Object(r.a)(j,2),w=O[0],S=O[1];return Object(l.useEffect)((function(){return t?m(setInterval((function(){o((function(e){return e+1}))}),1e3)):clearInterval(f)}),[t]),Object(l.useEffect)((function(){var e,t,a;e=Math.floor(s/3600),t=Math.floor((s-3600*e)/60),a=s-(3600*e+60*t),b(String(e).padStart(2,"0")),E(String(t).padStart(2,"0")),S(String(a).padStart(2,"0"))}),[s]),c.a.createElement("div",{id:"timer"},c.a.createElement("strong",null,h," : ",g," : ",w))}),C=(a(25),document.getElementById("id01"));window.onclick=function(e){e.target===C&&(C.style.display="none")};var k=function(e){var t=e.logIn,a=Object(l.useState)(""),n=Object(r.a)(a,2),s=n[0],o=n[1];return c.a.createElement("div",null,c.a.createElement("button",{onClick:function(){return document.getElementById("id01").style.display="block"},className:"ENT"},"\u0418\u0433\u0440\u0430\u0442\u044c \xab\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0411\u043e\u0439\xbb"),c.a.createElement("div",{id:"id01",className:"modal"},c.a.createElement("form",{className:"modal-content animate",onSubmit:function(e){t(s)}},c.a.createElement("div",{className:"imgcontainer"},c.a.createElement("span",{onClick:function(){return document.getElementById("id01").style.display="none"},className:"close",title:"Close Modal"},"\xd7"),c.a.createElement("img",{src:"https://thumbs.gfycat.com/FrankFreeAmericankestrel-size_restricted.gif",alt:"Avatar",className:"avatar"})),c.a.createElement("div",{className:"container"},c.a.createElement("label",{htmlFor:"uname",style:{fontSize:"2vh"}},c.a.createElement("b",null,"\u041f\u0440\u0438\u0432\u0435\u0442, \u044f Smart, \u0430 \u0442\u044b...")),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("input",{className:"form-row",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f",name:"uname",autoComplete:"off",value:s,onChange:function(e){return o(e.target.value)},required:!0}),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("button",{type:"submit",className:"button1"},"\u0418\u0413\u0420\u0410\u0422\u042c")))))},A=a(3),M=a(4),z=a(6),_=a(5),P=a(7);a(26);var V=function(e){function t(){var e,a;Object(A.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(z.a)(this,(e=Object(_.a)(t)).call.apply(e,[this].concat(r)))).state={messages:[],member:{username:"name",color:"rgba("+d.a.random(255)+", "+d.a.random(255)+", "+d.a.random(255)+", 0.8)"}},a.onSendMessage=function(e){var t=a.state.messages,n=a.state.member;t.push({member:n,text:e}),a.setState({messages:t})},a}return Object(P.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){return c.a.createElement("div",{className:"Chat"},c.a.createElement("div",{className:"Chat-header"},c.a.createElement("h1",null,"\u041e\u0431\u0449\u0438\u0439 \u0447\u0430\u0442")),c.a.createElement(F,{messages:this.state.messages,currentMember:this.state.member}),c.a.createElement(T,{onSendMessage:this.onSendMessage}))}}]),t}(l.Component),T=function(e){function t(){var e,a;Object(A.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(z.a)(this,(e=Object(_.a)(t)).call.apply(e,[this].concat(r)))).state={text:""},a}return Object(P.a)(t,e),Object(M.a)(t,[{key:"onChange",value:function(e){this.setState({text:e.target.value})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSendMessage(this.state.text),this.setState({text:""})}},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"Input"},c.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)},className:"chat_form"},c.a.createElement("input",{className:"chat_input",onChange:function(t){return e.onChange(t)},value:this.state.text,type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"}),c.a.createElement("button",{className:"chat_button"},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))}}]),t}(l.Component);var F=function(e){function t(){return Object(A.a)(this,t),Object(z.a)(this,Object(_.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){var e=this,t=this.props.messages;return c.a.createElement("ul",{className:"Messages-list"},t.map((function(t){return e.renderMessage(t)})))}},{key:"renderMessage",value:function(e){var t=e.member,a=e.text,n=this.props.currentMember,r=t.id===n.id,l=r?"Messages-message currentMember":"Messages-message";return c.a.createElement("li",{className:l},c.a.createElement("div",{className:"Message-content"},!r&&c.a.createElement("div",{className:"username"},t.username),c.a.createElement("div",{className:"text",style:{backgroundColor:n.color}},a)))}}]),t}(l.Component),R=(a(27),function(e){var t=e.fleet,a=e.name,n=e.player,l="".concat("AI"===n?"flex-start":"flex-end");return c.a.createElement("div",{className:"info_ships"},c.a.createElement("div",{className:"name",style:{justifyContent:l}},a),c.a.createElement("div",{className:"ships"},Object.entries(t).map((function(e,t){var a=Object(r.a)(e,2),n=(a[0],a[1]);return c.a.createElement("div",{className:"ships__same_type",key:t,style:{justifyContent:l}},n.units.map((function(e,t){return c.a.createElement("div",{className:"ships__unit",key:t,style:{width:"".concat(15*e.length,"px")}})})))}))))});Object(s.render)(c.a.createElement((function(){var e=Object(l.useState)(""),t=Object(r.a)(e,2),a=t[0],s=t[1];return a?c.a.createElement(o,{logout:function(){fetch("/api/users",{method:"delete",headers:Object(n.a)({},i.defaultHeaders)}).then((function(e){if(200!==e.status)throw new Error(e.statusText);console.log("logout for ".concat(a," is successful")),s("")})).catch((function(e){return alert(e)}))},userName:a}):c.a.createElement(k,{logIn:function(e){s(e)}})}),null),document.getElementById("root"))}],[[13,1,2]]]);
//# sourceMappingURL=main.17480df5.chunk.js.map